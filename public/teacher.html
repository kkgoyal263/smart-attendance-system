<!DOCTYPE html>
<html>
<head>
  <title>Teacher Panel</title>
  <link rel="stylesheet" href="teacher.css">
</head>
<body>

<div class="navbar">
  <h3>Smart Attendance | Teacher Panel</h3>

  <div class="user-box">
    <div class="avatar" id="avatar"></div>
    <div class="username" id="username"></div>
    <button onclick="logout()">Logout</button>
  </div>
</div>


<div class="container">

  <div class="card">

    <h2>Teacher Panel</h2>

    <input id="subject" placeholder="Enter Subject">

    <button onclick="generate()">Generate QR</button>

    <img id="qr" width="220"/>

  </div>

</div>

<script>

const user = JSON.parse(localStorage.getItem("user"));
document.getElementById("avatar").innerText = user.name[0].toUpperCase();
document.getElementById("username").innerText = user.name;


if(!user){
  window.location = "/";
}

function logout(){
  localStorage.clear();
  window.location = "/";
}

async function generate(){

  const subject = document.getElementById("subject").value;

  const res = await fetch("/api/attendance/generate", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-auth-token": localStorage.getItem("token")
    },

    body: JSON.stringify({
      subject,
      teacherId: user.id
    })
  });

  const data = await res.json();

  document.getElementById("qr").src = data.qr;
}

async function loadSummary(){

  const res = await fetch(
    `/api/attendance/teacher-summary/${user.id}`,
    {
      headers: {
        "x-auth-token": localStorage.getItem("token")
      }
    }
  );

  const data = await res.json();

  const list = document.getElementById("summary");
  list.innerHTML = "";

  if(data.length === 0){
    list.innerHTML = "<li>No records yet</li>";
    return;
  }

  data.forEach(item => {

    const li = document.createElement("li");

    li.innerText =
      `${item._id.date} | ${item._id.subject} â†’ ${item.count} students`;

    list.appendChild(li);

  });

}

</script>

</body>
</html>
